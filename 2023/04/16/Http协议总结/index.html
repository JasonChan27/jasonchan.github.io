

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" href="/img/avatar.JPG">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Jason Chan">
  <meta name="keywords" content="笔记,博客">
  
    <meta name="description" content="一、Http 基础1、网络协议分层  物理层主要作用是定义物理设备如何传输数据 数据链路层在通信的实体间建立数据链路层（0101 之类的） 网络层为数据在结点之间传输创建逻辑链路 传输层向用户提供可靠的端到端服务，传输层向高层屏蔽了下层数据通信的细节 应用层为应用软件提供了很多服务，构建于 TCP 协议之上，屏蔽网络传输相关细节">
<meta property="og:type" content="article">
<meta property="og:title" content="Http协议总结">
<meta property="og:url" content="https://jasonchan27.github.io/2023/04/16/Http%E5%8D%8F%E8%AE%AE%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="Jason的笔记">
<meta property="og:description" content="一、Http 基础1、网络协议分层  物理层主要作用是定义物理设备如何传输数据 数据链路层在通信的实体间建立数据链路层（0101 之类的） 网络层为数据在结点之间传输创建逻辑链路 传输层向用户提供可靠的端到端服务，传输层向高层屏蔽了下层数据通信的细节 应用层为应用软件提供了很多服务，构建于 TCP 协议之上，屏蔽网络传输相关细节">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/1-1.png">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/1-2.png">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/1-3.png">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/1-4.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-1.png">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-2.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-3.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-4.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-5.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-6.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-7.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-8.jpg">
<meta property="og:image" content="https://jasonchan27.github.io/images/http/2-9.jpg">
<meta property="article:published_time" content="2023-04-16T06:29:08.000Z">
<meta property="article:modified_time" content="2023-04-17T10:35:42.244Z">
<meta property="article:author" content="Jason Chan">
<meta property="article:tag" content="复习总结">
<meta property="article:tag" content="原理">
<meta property="article:tag" content="Http协议">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://jasonchan27.github.io/images/http/1-1.png">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Http协议总结 - Jason的笔记</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"jasonchan27.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"UsaXddA42sfhvk7QGhCaqFp4-gzGzoHsz","app_key":"6VmPvhwsZaqK74sTVXv7PP8K","server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Jason&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Http协议总结"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-04-16 14:29" pubdate>
          2023年4月16日 下午
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          21k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          177 分钟
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Http协议总结</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="一、Http-基础"><a href="#一、Http-基础" class="headerlink" title="一、Http 基础"></a>一、Http 基础</h1><h2 id="1、网络协议分层"><a href="#1、网络协议分层" class="headerlink" title="1、网络协议分层"></a>1、网络协议分层</h2><p><img src="/images/http/1-1.png" srcset="/img/loading.gif" lazyload alt="图一-1"></p>
<ul>
<li>物理层主要作用是定义物理设备如何传输数据</li>
<li>数据链路层在通信的实体间建立数据链路层（0101 之类的）</li>
<li>网络层为数据在结点之间传输创建逻辑链路</li>
<li>传输层向用户提供可靠的端到端服务，传输层向高层屏蔽了下层数据通信的细节</li>
<li>应用层为应用软件提供了很多服务，构建于 TCP 协议之上，屏蔽网络传输相关细节</li>
</ul>
<span id="more"></span>

<h2 id="2、HTTP-发展历史"><a href="#2、HTTP-发展历史" class="headerlink" title="2、HTTP 发展历史"></a>2、HTTP 发展历史</h2><h3 id="i、HTTP-x2F-0-9"><a href="#i、HTTP-x2F-0-9" class="headerlink" title="i、HTTP&#x2F;0.9"></a>i、HTTP&#x2F;0.9</h3><ul>
<li>只有一个命令 GET</li>
<li>没有 HEADER 等描述数据的信息</li>
<li>服务器发送完毕，就关闭 TCP 连接</li>
</ul>
<h3 id="ii、HTTP-x2F-1-0"><a href="#ii、HTTP-x2F-1-0" class="headerlink" title="ii、HTTP&#x2F;1.0"></a>ii、HTTP&#x2F;1.0</h3><ul>
<li>增加了很多命令（POST&#x2F;PUT 等）</li>
<li>增加 status code 和 header</li>
<li>多字符集支持、多部分发送、权限、缓存等</li>
</ul>
<h3 id="iii、HTTP-x2F-1-1"><a href="#iii、HTTP-x2F-1-1" class="headerlink" title="iii、HTTP&#x2F;1.1"></a>iii、HTTP&#x2F;1.1</h3><ul>
<li>持久连接</li>
<li>pipeline 在同一个连接里发送多个请求</li>
<li>增加 host（同一个物理服务器可以跑多个 web 服务）和其他一些命令</li>
</ul>
<h3 id="iv、HTTP-x2F-2"><a href="#iv、HTTP-x2F-2" class="headerlink" title="iv、HTTP&#x2F;2"></a>iv、HTTP&#x2F;2</h3><ul>
<li>所有数据以二进制传输（之前是字符串）</li>
<li>同一个连接里面发送多个请求不再需要按照顺序来，可以同时多个请求数据</li>
<li>头信息压缩（减少带宽使用）以及推送等提高效率的功能（服务端可以主动发起传输）</li>
</ul>
<h2 id="2、HTTP-的三次握手"><a href="#2、HTTP-的三次握手" class="headerlink" title="2、HTTP 的三次握手"></a>2、HTTP 的三次握手</h2><p>HTTP 是不存在连接这么个概念的，只有请求和响应这个概念，都是数据包，所以它需要一个传输的通道——<code>TCP connection</code>。</p>
<p>HTTP 在完成了三次握手之后，会创建一个 TCP connection,http 请求是在这个连接的基础上发送的。如下图所示：</p>
<p><img src="/images/http/1-2.png" srcset="/img/loading.gif" lazyload alt="图一-2"></p>
<p>三次握手的时序图如下图所示：</p>
<p><img src="/images/http/1-3.png" srcset="/img/loading.gif" lazyload alt="图一-3"></p>
<ol>
<li>客户端发送 SYN 包(SYN&#x3D;X)到服务器，并进入 SYN_SEND 状态，等待服务器确认；</li>
<li>服务器收到 SYN 包，必须确认客户的 SYN（ACK&#x3D;X+1），同时自己也发送一个 SYN 包（SYN&#x3D;Y），即 SYN+ACK 包，此时服务器进入 SYN_RECV 状态；</li>
<li>客户端收到服务器的 SYN ＋ ACK 包，向服务器发送确认包 ACK(ACK&#x3D;Y+1)，此包发送完毕，客户端和服务器进入 ESTABLISHED 状态，完成三次握手。</li>
</ol>
<p>需注意：</p>
<ul>
<li>URI(Uniform Resource Identifier，统一资源标识符)：用来唯一标识互联网上的信息资源。其包含：<ul>
<li>URL（Uniform Resource Loator，统一资源定位器）</li>
<li>URN(永久统一资源定位符：在资源被移动后还能找到)</li>
</ul>
</li>
<li>长链接: Chrome 的并发限制是 6 条，当一个页面有 6 个以上的请求发送时，会创建 6 个长链接 TCP connection，在控制面板 network 的 Waterfall 中可以看出。</li>
</ul>
<p>如果一个页面中有很多图片，下面的往往加载很慢，就是因为并发只有 6 个，后面的需要等待前面的执行完毕。同时，会复用前面的 TCP 连接 Connection: keep-alive</p>
<h2 id="3、HTTP-报文格式"><a href="#3、HTTP-报文格式" class="headerlink" title="3、HTTP 报文格式"></a>3、HTTP 报文格式</h2><p>HTTP 的请求报文和响应报文格式如下图所示：</p>
<p><img src="/images/http/1-4.jpg" srcset="/img/loading.gif" lazyload alt="图一-4"></p>
<h3 id="i、请求报文"><a href="#i、请求报文" class="headerlink" title="i、请求报文"></a>i、请求报文</h3><p>一个 HTTP 请求报文由请求行（request line）、请求头部（header）、空行（blank line）和请求数据（request-body）4 个部分组成：</p>
<ul>
<li>请求头。由请求方法字段、URL 字段和 HTTP 协议版本字段 3 个字段组成，它们用空格分隔。例如，GET &#x2F;index.html HTTP&#x2F;1.1。<ul>
<li>HTTP 协议的请求方法有 GET、POST、HEAD、PUT、DELETE、OPTIONS、TRACE、CONNECT。</li>
</ul>
</li>
<li>请求头部。由关键字&#x2F;值对组成，每行一对，关键字和值用英文冒号“:”分隔。请求头部通知服务器有关于客户端请求的信息，典型的请求头有：<ul>
<li>User-Agent：产生请求的浏览器类型。</li>
<li>Accept：客户端可识别的内容类型列表。</li>
<li>Host：请求的主机名，允许多个域名同处一个 IP 地址，即虚拟主机。</li>
</ul>
</li>
<li>空行。最后一个请求头之后是一个空行，发送回车符和换行符，通知服务器以下不再有请求头。</li>
<li>请求数据。请求数据不在 GET 方法中使用，而是在 POST 方法中使用。POST 方法适用于需要客户填写表单的场合。</li>
</ul>
<h3 id="ii、响应报文"><a href="#ii、响应报文" class="headerlink" title="ii、响应报文"></a>ii、响应报文</h3><p>HTTP 响应也由四个部分组成，分别是：状态行（status line）、消息报头（header）、空行（blank line）和响应正文（response-body）。HTTP 响应的格式与请求的格式十分类似，唯一的区别是在于第一行中用状态信息（status line）代替了请求信息（request line）。</p>
<p>状态行格式如：<code>HTTP-Version Status-Code Reason-Phrase CRLF</code></p>
<p>其中，</p>
<ul>
<li>HTTP-Version 表示服务器 HTTP 协议的版本</li>
<li>Status-Code 表示服务器发回的响应状态代码。状态代码由三位数字组成，第一个数字定义了响应的类别，且有五种可能取值：<ul>
<li>1xx：指示信息–表示请求已接收，继续处理。</li>
<li>2xx：成功–表示请求已被成功接收、理解、接受。</li>
<li>3xx：重定向–要完成请求必须进行更进一步的操作。</li>
<li>4xx：客户端错误–请求有语法错误或请求无法实现。</li>
<li>5xx：服务器端错误–服务器未能实现合法的请求。</li>
</ul>
</li>
<li>Reason-Phrase 表示状态代码的文本描述。</li>
</ul>
<p>常见状态代码、状态描述的说明：</p>
<ul>
<li>200 OK：客户端请求成功。</li>
<li>400 Bad Request：客户端请求有语法错误，不能被服务器所理解。</li>
<li>401 Unauthorized：请求未经授权，这个状态代码必须和 WWW-Authenticate 报头域一起使用。</li>
<li>403 Forbidden：服务器收到请求，但是拒绝提供服务。</li>
<li>404 Not Found：请求资源不存在，举个例子：输入了错误的 URL。</li>
<li>500 Internal Server Error：服务器发生不可预期的错误。</li>
<li>503 Server Unavailable：服务器当前不能处理客户端的请求，一段时间后可能恢复正常，举个例子：HTTP&#x2F;1.1 200 OK（CRLF）。</li>
</ul>
<h3 id="iii、HTTP-协议常见请求-x2F-响应头"><a href="#iii、HTTP-协议常见请求-x2F-响应头" class="headerlink" title="iii、HTTP 协议常见请求&#x2F;响应头"></a>iii、HTTP 协议常见请求&#x2F;响应头</h3><ul>
<li>Content-Type:请求的与实体对应的 MIME 信息</li>
<li>Accept：指定客户端能接受的内容类型</li>
<li>Origin：最初的请求来源于哪儿，主要用于 POST 请求<ul>
<li>origin 的提出，本身就是在 HTML5 中跨域操作所引入的。 其具体流程是，当一个链接或者 XMLHttpRequest 去请求跨域操作，浏览器事实上的确向目标服务器发起了连接请求，并且携带这 origin。 当服务器返回时，浏览器将检查 response 中是否包含 Access-Control-Allow-Origin 字段，当缺少这个字段时，浏览器将 abort，abort 的意思是不显示，不产生事件，就好像没有请求过，甚至在 network 区域里面都看不到。 当存在这个 header 时，浏览器将检查当前请求所在域是否在这个 access-control-allow-origin 所允许的域内，如果是，继续下去，如果不存在，abort！</li>
</ul>
</li>
<li>Cookie：发送给服务端的 cookie 的值</li>
<li>Cache-Control：指定缓存响应机制（public&#x2F;private&#x2F;no-cache）</li>
<li>private 是指，只允许发送请求的域名进行缓存，其他代理的不允许</li>
<li>User-Agent：用户信息</li>
<li>X-Forwarded-For：请求端真实的 IP</li>
<li>Access-Control-Allow-Origin：允许特定的域名来访问（跨域使用）</li>
<li>Last-Modified：请求资源的最后响应时间，在服务端设置后，对应的在 Request Headers 中，会携带 If-Modified-Since 头</li>
<li>Etag：通过数据签名，进行是否缓存验证，在服务端设置后，对应的在 Request Headers 中，会携带 If-None-Match 头</li>
<li>Connection: 通知浏览器保持当前 HTTP 连接，以便在策略允许范围内进行连接复用</li>
<li>Keep-Alive: 保持连接的策略</li>
</ul>
<h1 id="二、Http-特性"><a href="#二、Http-特性" class="headerlink" title="二、Http 特性"></a>二、Http 特性</h1><h2 id="1、CORS-跨域请求"><a href="#1、CORS-跨域请求" class="headerlink" title="1、CORS 跨域请求"></a>1、CORS 跨域请求</h2><h3 id="i、浏览器同域限制"><a href="#i、浏览器同域限制" class="headerlink" title="i、浏览器同域限制"></a>i、浏览器同域限制</h3><p>如果服务端没有设置头信息 Access-Control-Allow-Origin，在前端跨域请求时，虽然客户端的请求还会被服务端正常接收，但是浏览器会把服务端返回的数据忽略掉，并在 console 中报错，这是浏览器的同源策略。</p>
<p>解决方案一是服务端设置<code>Access-Control-Allow-Origin</code>响应头：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript">res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>  <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:8888&quot;</span>, <span class="hljs-comment">// 设置后，则对‘http://127.0.0.1:8888’来源的请求放开同域限制，从而浏览器可以实现跨于请求</span><br>&#125;);<br></code></pre></td></tr></table></figure>

<p>解决方案二是使用 jsonp：</p>
<ul>
<li>利用动态创建一个 script 标签，因为 script 标签是没有同源策略限制的，是可以跨域的</li>
<li>把这个 script 标签的 src 指向我们请求的服务端地址，这个地址会携带一个参数：callback，一个回调函数，服务端会把数据通过这个回调函数返回给客户端，但是客户端没有这个函数怎么接收呢？所以在发送请求之前，要在全局（window）注册这样一个方法，利用这个方法，来获得数据。</li>
</ul>
<p>举个例子，通过 jsonp 请求获取 name 的值：</p>
<p>客户端代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-comment">// 注册一个回调函数getName</span></span><br><span class="language-javascript">      <span class="hljs-variable language_">window</span>.<span class="hljs-property">getName</span> = <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;获取到的name是：&quot;</span>, res);</span><br><span class="language-javascript">      &#125;;</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 通过script标签请求服务端的资源 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://127.0.0.1:8887?callback=getName&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>服务端代码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;request come&quot;</span>, request.<span class="hljs-property">url</span>);<br>    <span class="hljs-keyword">const</span> urlObj = url.<span class="hljs-title function_">parse</span>(request.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// url解析后的结果：&#123; query :&#123; callback: &#x27;getName&#x27; &#125;, ... &#125;</span><br>    <span class="hljs-keyword">const</span> callback = urlObj.<span class="hljs-property">query</span>.<span class="hljs-property">callback</span>;<br>    <span class="hljs-keyword">if</span> (callback === <span class="hljs-string">&quot;getName&quot;</span>) &#123;<br>      <span class="hljs-comment">// 如果是客户端约定的getName回调函数，则返回对应的资源</span><br>      response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;getName(&#x27;Jason&#x27;)&quot;</span>);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>    response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;123&quot;</span>);<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8887</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8887&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>可以看到浏览器控制台的输入： <code>获取到的name是： Jason</code>，这样就通过 jsonp 的方式绕过浏览器的同源限制，从而实现了跨域请求。但需要注意的是，jsonp 只支持<code>get</code>请求。</p>
<h3 id="ii、预请求"><a href="#ii、预请求" class="headerlink" title="ii、预请求"></a>ii、预请求</h3><p>浏览器将 CORS 请求分成两类：简单请求（simple request）和非简单请求（not-so-simple request）。只要同时满足以下两大条件，就属于简单请求。</p>
<ol>
<li>请求方法是以下三种方法之一：<ul>
<li>HEAD</li>
<li>GET</li>
<li>POST</li>
</ul>
</li>
<li>HTTP 的头信息不超出以下几种字段：<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值 application&#x2F;x-www-form-urlencoded、multipart&#x2F;form-data、text&#x2F;plain</li>
</ul>
</li>
</ol>
<p>对于简单请求，浏览器直接发出 CORS 请求。</p>
<p>而非简单请求的 CORS 请求，会在正式通信之前，增加一次 HTTP 查询请求，称为”预检”请求（preflight）。非简单请求是那种对服务器有特殊要求的请求，比如请求方法是 PUT 或 DELETE，或者 Content-Type 字段的类型是 application&#x2F;json。</p>
<p>除了 Origin 字段也就是 Access-Control-Allow-Origin 外，预请求的头信息包括两个特殊字段：</p>
<ul>
<li>Access-Control-Request-Method</li>
<li>Access-Control-Request-Headers</li>
</ul>
<p><code>Access-Control-Request-Method</code>字段是必须的，用来列出浏览器的 CORS 请求会用到哪些 HTTP 方法，比如 PUT。<code>Access-Control-Request-Headers</code>字段是一个逗号分隔的字符串，指定浏览器 CORS 请求会额外发送的头信息字段，比如 X-Test-Cors。</p>
<p>举个例子，在服务端对预请求的限制：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;url&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-keyword">const</span> urlObj = url.<span class="hljs-title function_">parse</span>(request.<span class="hljs-property">url</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// url解析后的结果：&#123; query :&#123; callback: &#x27;getName&#x27; &#125;, ... &#125;</span><br>    <span class="hljs-keyword">const</span> callback = urlObj.<span class="hljs-property">query</span>.<span class="hljs-property">callback</span>;<br>    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span> == <span class="hljs-string">&quot;http://127.0.0.1:8888&quot;</span>) &#123;<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:8888&quot;</span>,<br>        <span class="hljs-string">&quot;Access-Control-Allow-Methods&quot;</span>: <span class="hljs-string">&quot;POST, PUT, DELETE&quot;</span>, <span class="hljs-comment">// 允许的methed</span><br>        <span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>: <span class="hljs-string">&quot;X-Test-Cors&quot;</span>, <span class="hljs-comment">// 允许的请求头</span><br>        <span class="hljs-string">&quot;Access-Control-Allow-Headers&quot;</span>: <span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-comment">// 允许的请求头</span><br>        <span class="hljs-string">&quot;Access-Control-Max-Age&quot;</span>: <span class="hljs-string">&quot;1000&quot;</span>, <span class="hljs-comment">// 在这个时间段内，只需要一次预请求</span><br>      &#125;);<br>    &#125;<br>    response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;123&quot;</span>);<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8887</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8887&quot;</span>);<br></code></pre></td></tr></table></figure>

<h2 id="2、缓存"><a href="#2、缓存" class="headerlink" title="2、缓存"></a>2、缓存</h2><h3 id="i、Cache-Control"><a href="#i、Cache-Control" class="headerlink" title="i、Cache-Control"></a>i、Cache-Control</h3><p>Cache-Control 通用消息头字段，被用于在 http 请求和响应中，通过指定指令来实现缓存机制。缓存指令是单向的，这意味着在请求中设置的指令，不一定被包含在响应中。</p>
<p>语法指令分类及含义如下：</p>
<ul>
<li>可缓存性<ul>
<li>public。表明响应可以被任何对象（包括：发送请求的客户端，代理服务器，等等）缓存，即使是通常不可缓存的内容。（例如：1.该响应没有 max-age 指令或 Expires 消息头；2. 该响应对应的请求方法是 POST 。）</li>
<li>private。表明响应只能被单个用户缓存，不能作为共享缓存（即代理服务器不能缓存它）。私有缓存可以缓存响应内容，比如：对应用户的本地浏览器。</li>
<li>no-cache。在发布缓存副本之前，强制要求缓存把请求提交给原始服务器进行验证 (协商缓存验证)。</li>
<li>no-store。缓存不应存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存。</li>
</ul>
</li>
<li>到期<ul>
<li>max-age&#x3D;<seconds>。设置缓存存储的最大周期，超过这个时间缓存被认为过期 (单位秒)。</li>
<li>s-maxage&#x3D;<seconds>。覆盖 max-age 或者 Expires 头，但是仅适用于共享缓存 (比如各个代理)，私有缓存会忽略它。</li>
<li>max-stale[&#x3D;<seconds>]。表明客户端愿意接收一个已经过期的资源。可以设置一个可选的秒数，表示响应不能已经过时超过该给定的时间。</li>
</ul>
</li>
<li>重新验证和重新加载<ul>
<li>must-revalidate。一旦资源过期（比如已经超过 max-age），在成功向原始服务器验证之前，缓存不能用该资源响应后续请求。</li>
<li>proxy-revalidate。与 must-revalidate 作用相同，但它仅适用于共享缓存（例如代理），并被私有缓存忽略。</li>
<li>immutable。表示响应正文不会随时间而改变。资源（如果未过期）在服务器上不发生改变，因此客户端不应发送重新验证请求头（例如 If-None-Match 或 If-Modified-Since）来检查更新，即使用户显式地刷新页面。</li>
</ul>
</li>
<li>其它<ul>
<li>no-transform。不得对资源进行转换或转变。Content-Encoding、Content-Range、Content-Type 等 HTTP 头不能由代理修改。</li>
<li>only-if-cached。表明客户端只接受已缓存的响应，并且不要向原始服务器检查是否有更新的拷贝。</li>
</ul>
</li>
</ul>
<h3 id="ii、缓存验证-Last-Modified-和-Etag-的使用"><a href="#ii、缓存验证-Last-Modified-和-Etag-的使用" class="headerlink" title="ii、缓存验证 Last-Modified 和 Etag 的使用"></a>ii、缓存验证 Last-Modified 和 Etag 的使用</h3><p>浏览器使用 Cache-Control 命中缓存的机制如下图所示：</p>
<p><img src="/images/http/2-1.png" srcset="/img/loading.gif" lazyload alt="图二-1"></p>
<p>验证缓存有两种：Last-Modified 和 Etag</p>
<h5 id="1-Last-Modified"><a href="#1-Last-Modified" class="headerlink" title="1) Last-Modified"></a>1) Last-Modified</h5><ul>
<li>表示上次修改的时间</li>
<li>配合<code>If-Modified-Since</code>或<code>If-Unmodified-Since</code>使用</li>
<li>对比上次修改时间以验证资源是否需要更新</li>
</ul>
<p>举个例子，使用<em>Last-Modified</em>验证缓存：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> html = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;test.html&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br>      <span class="hljs-keyword">const</span> ifModifiedSince = request.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;if-modified-since&quot;</span>];<br>      <span class="hljs-keyword">if</span> (ifModifiedSince === <span class="hljs-string">&quot;Sun, 16 Apr 2023 10:50:27 GMT&quot;</span>) &#123;<br>        response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">304</span>, &#123;<br>          <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>          <span class="hljs-string">&quot;Cache-Control&quot;</span>: <span class="hljs-string">&quot;max-age=20000000, no-cache&quot;</span>,<br>          <span class="hljs-string">&quot;Last-Modified&quot;</span>: <span class="hljs-string">&quot;Sun, 16 Apr 2023 10:50:27 GMT&quot;</span>,<br>        &#125;);<br>        response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>          <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>          <span class="hljs-string">&quot;Cache-Control&quot;</span>: <span class="hljs-string">&quot;max-age=20000000, no-cache&quot;</span>,<br>          <span class="hljs-string">&quot;Last-Modified&quot;</span>: <span class="hljs-string">&quot;Sun, 16 Apr 2023 10:50:27 GMT&quot;</span>,<br>        &#125;);<br>        response.<span class="hljs-title function_">end</span>(html);<br>      &#125;<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>上例客户端第一次请求<code>http://127.0.0.1:8888/</code>，则会返回 test.html，且响应头返回了<code>Last-Modified: Sun, 16 Apr 2023 18:48:50 GMT</code>标头，如下图：</p>
<p><img src="/images/http/2-2.jpg" srcset="/img/loading.gif" lazyload alt="图二-2"></p>
<p>当第二次请求时，请求头会携带上上次请求服务端返回的<code>Last-Modified</code>的值，如<code>If-Modified-Since: Sun, 16 Apr 2023 18:48:50 GMT</code>。</p>
<p>服务端会将该资源的修改时间与此头进行对比，如果相同，说明资源未改变，则响应 304，告诉客户端该资源要使用缓存资源。如下图：</p>
<p><img src="/images/http/2-3.jpg" srcset="/img/loading.gif" lazyload alt="图二-3"></p>
<h5 id="2-Etag"><a href="#2-Etag" class="headerlink" title="2) Etag"></a>2) Etag</h5><ul>
<li>表示数据签名</li>
<li>配合<code>If-Match</code>或<code>If-Non-Match</code>使用</li>
<li>对比资源的签名以判断是否使用缓存</li>
</ul>
<p>举个例子，使用<em>Etag</em>验证缓存：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> html = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;test.html&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br>      <span class="hljs-keyword">const</span> ifNoneMatch = request.<span class="hljs-property">headers</span>[<span class="hljs-string">&quot;if-none-match&quot;</span>];<br>      <span class="hljs-keyword">if</span> (ifNoneMatch === <span class="hljs-string">&quot;777&quot;</span>) &#123;<br>        response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">304</span>, &#123;<br>          <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>          <span class="hljs-string">&quot;Cache-Control&quot;</span>: <span class="hljs-string">&quot;max-age=20000000, no-cache&quot;</span>,<br>          <span class="hljs-title class_">Etag</span>: <span class="hljs-string">&quot;777&quot;</span>,<br>        &#125;);<br>        response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&quot;</span>);<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>          <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>          <span class="hljs-string">&quot;Cache-Control&quot;</span>: <span class="hljs-string">&quot;max-age=20000000, no-cache&quot;</span>,<br>          <span class="hljs-title class_">Etag</span>: <span class="hljs-string">&quot;777&quot;</span>,<br>        &#125;);<br>        response.<span class="hljs-title function_">end</span>(html);<br>      &#125;<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>上例客户端第一次请求<code>http://127.0.0.1:8888/</code>，则会返回 test.html，且响应头返回了<code>Etag: 777</code>标头，如下图：</p>
<p><img src="/images/http/2-4.jpg" srcset="/img/loading.gif" lazyload alt="图二-4"></p>
<p>当第二次请求时，请求头会携带上上次请求服务端返回的<code>Etag</code>的值，如<code>Etag: 777</code>。</p>
<p>服务端会将该资源计算后的<code>Etag</code>值与此头进行对比，如果相同，说明资源未改变，则响应 304，告诉客户端该资源要使用缓存资源。如下图：</p>
<p><img src="/images/http/2-5.jpg" srcset="/img/loading.gif" lazyload alt="图二-5"></p>
<h2 id="3、cookie-和-session"><a href="#3、cookie-和-session" class="headerlink" title="3、cookie 和 session"></a>3、cookie 和 session</h2><h3 id="i、cookie"><a href="#i、cookie" class="headerlink" title="i、cookie"></a>i、cookie</h3><p>Cookie 是一个 HTTP 请求标头，其中含有先前由服务器通过 Set-Cookie 标头投放或通过 JavaScript 的 Document.cookie 方法设置，然后存储到客户端的 HTTP cookie，浏览器下次请求会自动带上。cookie 是个键值对，可以设置多个。</p>
<p>举个例子，通过 Set-Cookie 设置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> html = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;test.html&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>        <span class="hljs-string">&quot;Set-Cookie&quot;</span>: [<span class="hljs-string">&quot;id=123; max-age=2&quot;</span>, <span class="hljs-string">&quot;abc=456;domain=test.com&quot;</span>],<br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>(html);<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>客户端访问<code>http://127.0.0.1:8888/</code>后，服务端回返回<em>Set-Cookie</em>标头，<code>id=123; max-age=2</code>会被存储到客户端，而<code>abc=456;domain=test.com</code>没被存储（跨域），如下图所示：</p>
<p><img src="/images/http/2-6.jpg" srcset="/img/loading.gif" lazyload alt="图二-6"></p>
<p>cookie 的属性：</p>
<ul>
<li>max-age 和 expire 设置过期时间</li>
<li>Secure 只在 https 的时候发送</li>
<li>HttpOnly: 禁止 JavaScript 通过 document.cookie 访问</li>
</ul>
<h3 id="ii、session"><a href="#ii、session" class="headerlink" title="ii、session"></a>ii、session</h3><p>session 主要的作用就是用来记录用户状态，表明用户身份的，session 的存储方式也有多样，最为传统的就是服务端保存 session 的内容，客户端浏览器 cookie 保存 sessionid，服务端通过客户端每次 http 请求带上的 cookie 中的 sessionid 去找到对应此用户的 session 内容。当然我之前也发过一篇文章讲到过通过 etag 来做为 sessionid，识别用户身份。</p>
<p>举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br><span class="hljs-comment">//全局sessions存放所有的session</span><br><span class="hljs-keyword">var</span> sessions = &#123;&#125;;<br><span class="hljs-keyword">var</span> key = <span class="hljs-string">&quot;session_id&quot;</span>;<br><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">EXPIRES</span> = <span class="hljs-number">20</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">//过期时长</span><br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>    req.<span class="hljs-property">cookies</span> = <span class="hljs-title function_">parseCookie</span>(req.<span class="hljs-property">headers</span>.<span class="hljs-property">cookie</span>); <span class="hljs-comment">//解析客户端的cookie，,暂存在req.cookies上</span><br>    <span class="hljs-keyword">var</span> id = req.<span class="hljs-property">cookies</span>[key]; <span class="hljs-comment">//取出每个用户唯一的id口令</span><br>    <span class="hljs-comment">//更新session状态</span><br>    <span class="hljs-keyword">if</span> (!id) &#123;<br>      req.<span class="hljs-property">session</span> = <span class="hljs-title function_">generate</span>(); <span class="hljs-comment">//生成新的session</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-keyword">var</span> session = sessions[id]; <span class="hljs-comment">//从全局sessions中取出对应id的session，判断session状态</span><br>      <span class="hljs-keyword">if</span> (session) &#123;<br>        <span class="hljs-keyword">if</span> (session.<span class="hljs-property">cookie</span>.<span class="hljs-property">expire</span> &gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()) &#123;<br>          <span class="hljs-comment">//更新超时时间</span><br>          session.<span class="hljs-property">cookie</span>.<span class="hljs-property">expire</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() + <span class="hljs-variable constant_">EXPIRES</span>;<br>          req.<span class="hljs-property">session</span> = session;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          <span class="hljs-comment">//超时了，删除旧的数据，重新生成</span><br>          <span class="hljs-keyword">delete</span> sessions[id];<br>          req.<span class="hljs-property">session</span> = <span class="hljs-title function_">generate</span>();<br>        &#125;<br>      &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">//sessions中不存在该id的session（id口令匹配错误或客户端保存着id，但服务器端因超时导致session已取消）,重新生成</span><br>        req.<span class="hljs-property">session</span> = <span class="hljs-title function_">generate</span>();<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">//业务处理，返回客户端</span><br>    <span class="hljs-title function_">handle</span>(req, res);<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-comment">//生成新的session,并存储于sessions</span><br><span class="hljs-keyword">var</span> generate = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">var</span> session = &#123;&#125;;<br>  session.<span class="hljs-property">id</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>(); <span class="hljs-comment">//id为当前时间加上随机值</span><br>  session.<span class="hljs-property">cookie</span> = &#123;<br>    <span class="hljs-attr">expire</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>() + <span class="hljs-variable constant_">EXPIRES</span>, <span class="hljs-comment">//cookie为当前时间加上超时时长</span><br>  &#125;;<br>  sessions[session.<span class="hljs-property">id</span>] = session;<br>  <span class="hljs-keyword">return</span> session; <span class="hljs-comment">//返回当前新建的session</span><br>&#125;;<br><br><span class="hljs-comment">//业务处理</span><br><span class="hljs-keyword">var</span> handle = <span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) &#123;<br>  <span class="hljs-keyword">if</span> (!req.<span class="hljs-property">session</span>.<span class="hljs-property">isVisit</span>) &#123;<br>    sessions[req.<span class="hljs-property">session</span>.<span class="hljs-property">id</span>].<span class="hljs-property">isVisit</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">//修改服务器相应的session状态</span><br>    res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">&quot;Set-Cookie&quot;</span>, <span class="hljs-title function_">serialize</span>(key, req.<span class="hljs-property">session</span>.<span class="hljs-property">id</span>)); <span class="hljs-comment">//头部写入session的id</span><br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span> &#125;);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;h1&gt;第一次登陆&lt;/h1&gt;&quot;</span>);<br>  &#125; <span class="hljs-keyword">else</span> &#123;<br>    res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123; <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html;charset=utf-8&quot;</span> &#125;);<br>    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;h1&gt;再次登陆&lt;/h1&gt;&quot;</span>);<br>  &#125;<br>&#125;;<br><br><span class="hljs-comment">//解析客户端传来的cookie</span><br><span class="hljs-keyword">var</span> parseCookie = <span class="hljs-keyword">function</span> (<span class="hljs-params">cookie</span>) &#123;<br>  <span class="hljs-keyword">var</span> cookies = &#123;&#125;;<br>  <span class="hljs-keyword">if</span> (!cookie) &#123;<br>    <span class="hljs-comment">//为空，返回cookies</span><br>    <span class="hljs-keyword">return</span> cookies;<br>  &#125;<br>  <span class="hljs-comment">//存在cookie，则解析客户端的cookie，存储于cookies给服务端使用</span><br>  <span class="hljs-keyword">var</span> list = cookie.<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;;&quot;</span>); <span class="hljs-comment">//将Cookie值：key1=value; key2=value2转变为数组的形式</span><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; i++) &#123;<br>    <span class="hljs-keyword">var</span> pair = list[i].<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;=&quot;</span>);<br>    cookies[pair[<span class="hljs-number">0</span>].<span class="hljs-title function_">trim</span>()] = pair[<span class="hljs-number">1</span>].<span class="hljs-title function_">trim</span>(); <span class="hljs-comment">//trim用于删除字符串头尾的空格</span><br>  &#125;<br>  <span class="hljs-keyword">return</span> cookies;<br>&#125;;<br><br><span class="hljs-comment">//格式化cookie</span><br><span class="hljs-keyword">var</span> serialize = <span class="hljs-keyword">function</span> (<span class="hljs-params">name, val, opt</span>) &#123;<br>  <span class="hljs-keyword">var</span> pairs = [name + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-built_in">encodeURIComponent</span>(val)];<br>  opt = opt || &#123;&#125;;<br><br>  <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">path</span>) pair.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;Path=&quot;</span> + opt.<span class="hljs-property">path</span>); <span class="hljs-comment">//还可以设置其他选项Domain、Expires等</span><br>  <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">maxAge</span>) pairs.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;Max-Age=&quot;</span> + opt.<span class="hljs-property">maxAge</span>); <span class="hljs-comment">//告诉浏览器多久后过期</span><br>  <span class="hljs-keyword">return</span> pairs.<span class="hljs-title function_">join</span>(<span class="hljs-string">&quot;;&quot;</span>); <span class="hljs-comment">//将数组拼接成用分号连接的字符串</span><br>&#125;;<br></code></pre></td></tr></table></figure>

<h2 id="4、HTTP-长连接"><a href="#4、HTTP-长连接" class="headerlink" title="4、HTTP 长连接"></a>4、HTTP 长连接</h2><p>在 HTTP&#x2F;1.0 中，默认使用的是短连接。也就是说，浏览器和服务器每进行一次 HTTP 操作，就建立一次连接，但任务结束就中断连接。如果客户端浏览器访问的某个 HTML 或其他类型的 Web 页中包含有其他的 Web 资源，如 JavaScript 文件、图像文件、CSS 文件等；当浏览器每遇到这样一个 Web 资源，就会建立一个 HTTP 会话。</p>
<p>但从 HTTP&#x2F;1.1 起，默认使用长连接，用以保持连接特性。使用长连接的 HTTP 协议，会在响应头有加入这行代码：<code>Connection:keep-alive</code>。</p>
<p>在使用长连接的情况下，当一个网页打开完成后，客户端和服务器之间用于传输 HTTP 数据的 TCP 连接不会关闭，如果客户端再次访问这个服务器上的网页，会继续使用这一条已经建立的连接。Keep-Alive 不会永久保持连接，它有一个保持时间，可以在不同的服务器中设定这个时间。实现长连接要客户端和服务端都支持长连接。</p>
<p>Chrome 的并发限制是 6 条，当一个页面有 6 个以上的请求发送时，会创建 6 个长链接 TCP connection，在控制面板 network 的 Waterfall 中可以看出。如果一个页面中有很多图片，下面的往往加载很慢，就是因为并发只有 6 个，后面的需要等待前面的执行完毕。同时，会复用前面的 TCP 连接 Connection: keep-alive</p>
<h2 id="5、数据协商"><a href="#5、数据协商" class="headerlink" title="5、数据协商"></a>5、数据协商</h2><p>在客户端发送给服务端一个请求的时候，客户端会声明通过这个请求拿到的数据格式以及数据相关的一些限制要求。服务端会有很多不同类型的数据返回，它会根据请求的这个声明做出一个判断，根据请求头信息来区分返回数据。</p>
<p>请求：</p>
<ul>
<li>Accept：用来声明我想要什么样的数据，Accept 指定数据类型。<ul>
<li>这个数据类型会根据 MineType 的声明进行一个限制, 来告诉服务端想要的数据类型</li>
</ul>
</li>
<li>Accept-Encoding：代表数据是一个怎样的编码方式来进行传输<ul>
<li>主要用来限制服务端如何来进行数据的压缩，如：gzip, deflate, br 等</li>
</ul>
</li>
<li>Accept-Language：用来展示不同的语言<ul>
<li>一般根据这个头判断返回是中文还是英文，根据设计方案不同，如果还包含其他语言也是可以的</li>
</ul>
</li>
<li>User-Agent：用来判断浏览器相关信息<ul>
<li>一般移动端和 PC 端浏览器是不一样的，可以根据它来适配不同格式的页面</li>
</ul>
</li>
</ul>
<p>返回：</p>
<ul>
<li>Content-Type：对应请求中的 Accept 中的数据格式<ul>
<li>Content-Type 从 Accept 中选择一种作为最终数据的返回格式</li>
<li>在返回的时候就要明确声明返回的数据格式，用于客户端的判断显示</li>
</ul>
</li>
<li>Content-Encoding：对应请求中的 Accept-Encoding<ul>
<li>用于声明返回数据使用的压缩算法</li>
</ul>
</li>
<li>Content-Language：对应请求中的 Accept-Language<ul>
<li>用于声明返回数据中是否和请求中的语言一致</li>
</ul>
</li>
</ul>
<h2 id="6、Redirect"><a href="#6、Redirect" class="headerlink" title="6、Redirect"></a>6、Redirect</h2><p>URL 重定向（也称为 URL 转发）是一种为页面、表单或者整个 Web 站点&#x2F;应用提供多个 URL 地址的技术。HTTP 对此操作有一种特殊类型的响应，称为 HTTP 重定向（HTTP redirect）。</p>
<p>重定向可实现许多目标：</p>
<ul>
<li>站点维护或停机期间的临时重定向。</li>
<li>永久重定向将在更改站点的 URL 后，保留现有的链接&#x2F;书签、上传文件时表示进度的页面等。</li>
</ul>
<p>举个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;request come&quot;</span>, request.<span class="hljs-property">url</span>);<br><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">302</span>, &#123;<br>        <span class="hljs-comment">// or 301</span><br>        <span class="hljs-title class_">Location</span>: <span class="hljs-string">&quot;/new&quot;</span>,<br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/new&quot;</span>) &#123;<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;&lt;div&gt;this is content&lt;/div&gt;&quot;</span>);<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>上例客户端访问<code>http://127.0.0.1:8888/</code>后，服务端返回 302 状态码，并指定标头<em>Location: &#x2F;new</em>，随后浏览器则重定向一个新的资源请求，最后返回<code>/new</code>页面。如下图所示：</p>
<p><img src="/images/http/2-7.jpg" srcset="/img/loading.gif" lazyload alt="图二-7"></p>
<p>服务端也可以指定状态码 301，代表永久重定向，这样浏览器则不会请求<code>http://127.0.0.1:8888/</code>，而会直接去请求<code>/new</code>页面资源。</p>
<h2 id="7、CSP"><a href="#7、CSP" class="headerlink" title="7、CSP"></a>7、CSP</h2><p>内容安全策略（CSP）用于检测和减轻用于 Web 站点的特定类型的攻击，例如 XSS (en-US) 和数据注入等。</p>
<p>该安全策略的实现基于一个称作<em>Content-Security-Policy</em>的 HTTP 首部。</p>
<p>举个例子，</p>
<p>客户端代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>This is content<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 资源地址为百度页面的某个js文件 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/js/lib/jquery-1-edb203c114.10.2.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>服务端代码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;request come&quot;</span>, request.<span class="hljs-property">url</span>);<br><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> html = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;test.html&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>        <span class="hljs-string">&quot;Content-Security-Policy&quot;</span>: <span class="hljs-string">&quot;default-src &#x27;self&#x27;&quot;</span>, <span class="hljs-comment">// &#x27;script-src \&#x27;self\&#x27;; form-action \&#x27;self\&#x27;; report-uri /report&#x27;</span><br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>(html);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/javascript&quot;</span>,<br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&#x27;console.log(&quot;loaded script&quot;)&#x27;</span>);<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>服务端通过设置<em>Content-Security-Policy</em>标头为<code>default-src \&#39;self\&#39;</code>，客户端访问<code>http://127.0.0.1:8888/</code>后，当首页请求非本域名的资源时，浏览器将会忽略此请求，并报错，如下图所示：</p>
<p><img src="/images/http/2-8.jpg" srcset="/img/loading.gif" lazyload alt="图二-8"></p>
<p><img src="/images/http/2-9.jpg" srcset="/img/loading.gif" lazyload alt="图二-9"></p>
<h1 id="三、Nginx-代理及-HTTP2"><a href="#三、Nginx-代理及-HTTP2" class="headerlink" title="三、Nginx 代理及 HTTP2"></a>三、Nginx 代理及 HTTP2</h1><h2 id="1、Nginx-的基本配置"><a href="#1、Nginx-的基本配置" class="headerlink" title="1、Nginx 的基本配置"></a>1、Nginx 的基本配置</h2><p>在 nginx 的配置文件中，可以这样配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs conf">server &#123;<br>  listen       80;<br>  # listen       [::]:80 default_server;<br>  server_name  test.com; // 浏览器中访问的host name<br><br>  # return 302 https://$server_name$request_uri;<br><br>  location / &#123;<br>    proxy_pass http://127.0.0.1:8888; // 要代理到什么地方<br>    proxy_set_header Host $host; // 访问test.com时的请求头host的值<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样，当浏览器访问<code>test.com</code>时，nginx 会代理到<code>http://127.0.0.1:8888</code>。</p>
<h2 id="2、Nginx-的代理缓存"><a href="#2、Nginx-的代理缓存" class="headerlink" title="2、Nginx 的代理缓存"></a>2、Nginx 的代理缓存</h2><p>Nginx 只需要两个指令即可启用代理缓存，分别是<em>proxy_cache_path</em>和<em>proxy_cache</em>。proxy_cache_path 指令设置缓存的路径，proxy_cache 指令用来激活它。</p>
<p>在 nginx 的配置文件中，这样配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs conf">proxy_cache_path cache levels=1:2 keys_zone=my_cache:10m;<br><br>server &#123;<br>  listen       80;<br>  # listen       [::]:80 default_server;<br>  server_name  test.com; // 浏览器中访问的host name<br><br>  # return 302 https://$server_name$request_uri;<br><br>  location / &#123;<br>    proxy_cache my_cache;<br>    proxy_pass http://127.0.0.1:8888; // 要代理到什么地方<br>    proxy_set_header Host $host; // 访问test.com时的请求头host的值<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>这样，就实现了代理缓存。</p>
<p>举个例子进行测试：</p>
<p>客户端代码为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>This is content, and data is: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;data&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">      <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;</span><br><span class="language-javascript">      <span class="hljs-keyword">function</span> <span class="hljs-title function_">doRequest</span>(<span class="hljs-params"></span>) &#123;</span><br><span class="language-javascript">        <span class="hljs-keyword">var</span> data = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;data&quot;</span>);</span><br><span class="language-javascript">        data.<span class="hljs-property">innerText</span> = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="language-javascript">        <span class="hljs-title function_">fetch</span>(<span class="hljs-string">&quot;/data&quot;</span>, &#123;</span><br><span class="language-javascript">          <span class="hljs-attr">headers</span>: &#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// &#x27;X-Test-Cache&#x27;: index++ // 用来控制代理缓存所设的自定义字段</span></span><br><span class="language-javascript">          &#125;,</span><br><span class="language-javascript">        &#125;)</span><br><span class="language-javascript">          .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resp</span>) &#123;</span><br><span class="language-javascript">            <span class="hljs-keyword">return</span> resp.<span class="hljs-title function_">text</span>();</span><br><span class="language-javascript">          &#125;)</span><br><span class="language-javascript">          .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">text</span>) &#123;</span><br><span class="language-javascript">            data.<span class="hljs-property">innerText</span> = text;</span><br><span class="language-javascript">          &#125;);</span><br><span class="language-javascript">      &#125;</span><br><span class="language-javascript">      <span class="hljs-comment">// 请求资源data，并将内容渲染到页面上</span></span><br><span class="language-javascript">      <span class="hljs-title function_">doRequest</span>();</span><br><span class="language-javascript">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>服务端代码为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;http&quot;</span>);<br><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;fs&quot;</span>);<br><br><span class="hljs-comment">// 延迟返回</span><br><span class="hljs-keyword">const</span> <span class="hljs-title function_">wait</span> = (<span class="hljs-params">seconds</span>) =&gt; &#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    <span class="hljs-built_in">setTimeout</span>(resolve, seconds * <span class="hljs-number">1000</span>);<br>  &#125;);<br>&#125;;<br>http<br>  .<span class="hljs-title function_">createServer</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">request, response</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;request come&quot;</span>, request.<span class="hljs-property">url</span>);<br><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/&quot;</span>) &#123;<br>      <span class="hljs-keyword">const</span> html = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">&quot;test.html&quot;</span>, <span class="hljs-string">&quot;utf8&quot;</span>);<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;text/html&quot;</span>,<br>      &#125;);<br>      response.<span class="hljs-title function_">end</span>(html);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (request.<span class="hljs-property">url</span> === <span class="hljs-string">&quot;/data&quot;</span>) &#123;<br>      response.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, &#123;<br>        <span class="hljs-comment">//   &#x27;Cache-Control&#x27;: &#x27;max-age=2, s-maxage=20, private&#x27;, // 可控制代理缓存</span><br>        <span class="hljs-comment">//   &#x27;Vary&#x27;: &#x27;X-Test-Cache&#x27; // 代表只有浏览器的请求头X-Test-Cache和之前请求的值一样，才会缓存</span><br>      &#125;);<br>      <span class="hljs-comment">// 延迟2s返回内容success</span><br>      <span class="hljs-title function_">wait</span>(<span class="hljs-number">2</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> response.<span class="hljs-title function_">end</span>(<span class="hljs-string">&quot;success&quot;</span>));<br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">listen</span>(<span class="hljs-number">8888</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;server listening on 8888&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>因配置了 Nginx 代理缓存，上例客户端第一次访问<code>http://127.0.0.1:8888/</code>后，会去请求 data 资源并 2 后渲染到页面，但第二次访问后，会立即返回已经渲染好内容的页面，说明代理缓存生效。</p>
<p>当然，可通过配置<em>Cache-Control</em>标头来控制代理缓存：</p>
<ul>
<li>s-maxage：代理缓存的生效时间，同 max-age 的作用。</li>
<li>private：只能被单个用户缓存，不能作为共享缓存（即代理服务器不能缓存它）。私有缓存可以缓存响应内容，比如：对应用户的本地浏览器。</li>
<li>no-store：缓存不应存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存。</li>
</ul>
<h2 id="3、使用-Nginx-部署-HTTPS-服务"><a href="#3、使用-Nginx-部署-HTTPS-服务" class="headerlink" title="3、使用 Nginx 部署 HTTPS 服务"></a>3、使用 Nginx 部署 HTTPS 服务</h2><p>在 nginx 的配置文件中，这样配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs conf">proxy_cache_path cache levels=1:2 keys_zone=my_cache:10m;<br><br>server &#123;<br>    listen  80 default_server;<br>    listen  [::]:80 default_server;<br>    server_name test.com;<br>    return 302 https://$server_name$request_uri; // 如果访问http则自动跳转到https<br>&#125;<br><br>server &#123;<br>  listen       443;<br>  # listen       [::]:80 default_server;<br>  server_name  test.com; // 浏览器中访问的host name<br><br>  # return 302 https://$server_name$request_uri;<br><br>  ssl on;<br>  ssl_certificate_key certs/localhost-privkey.pem;<br>  ssl_certificate certs/localhost-cert.pem;<br><br>  location / &#123;<br>    proxy_cache my_cache;<br>    proxy_pass http://127.0.0.1:8888; // 要代理到什么地方<br>    proxy_set_header Host $host; // 访问test.com时的请求头host的值<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4、HTTP2"><a href="#4、HTTP2" class="headerlink" title="4、HTTP2"></a>4、HTTP2</h2><p>HTTP2 的优势：</p>
<ul>
<li>信道复用</li>
<li>分帧传输：同一个连接可并发地发送请求</li>
<li>Server Push：服务端可主动推送客户端</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%8A%80%E6%9C%AF/" class="category-chain-item">技术</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E5%A4%8D%E4%B9%A0%E6%80%BB%E7%BB%93/">#复习总结</a>
      
        <a href="/tags/%E5%8E%9F%E7%90%86/">#原理</a>
      
        <a href="/tags/Http%E5%8D%8F%E8%AE%AE/">#Http协议</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Http协议总结</div>
      <div>https://jasonchan27.github.io/2023/04/16/Http协议总结/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Jason Chan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年4月16日</div>
        </div>
      
      
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/04/17/Redux%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%E4%B8%8EReact-router/" title="Redux和Vuex状态管理库的实现原理">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Redux和Vuex状态管理库的实现原理</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/04/14/webpack%E5%AE%9E%E8%B7%B5%E6%80%BB%E7%BB%93/" title="webpack 实践总结">
                        <span class="hidden-mobile">webpack 实践总结</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"UsaXddA42sfhvk7QGhCaqFp4-gzGzoHsz","appKey":"6VmPvhwsZaqK74sTVXv7PP8K","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a><span>Jason</span></a> <i class="iconfont icon-love"></i> <a><span>Blog</span></a> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
